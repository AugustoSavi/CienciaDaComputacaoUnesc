<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Cadastro de personagens</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU" crossorigin="anonymous">
</head>

<body>
    <div class="container">
        <div class="row">
            <div class="col-sm-4 col-md-4 col-lg-5 mx-auto">
                <div class="card border-0 shadow rounded-3 my-5">
                    <div class="card-body p-4 p-sm-5">
                        <h1 class="font-weight-normal mb-4 text-center">Novo personagem</h1>
                        <form  id="form-novo-heroi" onsubmit="submitForm(event)">
                            <div class="form-floating mb-3">
                                <input type="number" class="form-control" id="floatingId" name="id" placeholder="Id" readonly>
                                <label for="floatingId">Id</label>
                            </div>
                            <div class="form-floating mb-3">
                                <input type="text" class="form-control" id="floatingName" name="name" placeholder="Name" required>
                                <label for="floatingName">Name</label>
                            </div>

                            <p class="mb-4 text-center">Image</p>

                            <div class="form-floating mb-3">
                                <input type="text" class="form-control" id="floatingImage" name="image" placeholder="Imagem url" required>
                                <label for="floatingImage">Imagem url</label>
                            </div>

                            <p class="mb-4 text-center">Powerstats</p>

                            <div class="form-floating mb-3">
                                <input type="number" min="1" max="100" class="form-control" id="floatingIntelligence" name="intelligence" placeholder="Intelligence" required>
                                <label for="floatingIntelligence">Intelligence</label>
                            </div>

                            <div class="form-floating mb-3">
                                <input type="number" min="1" max="100" class="form-control" id="floatingStrength" name="strength" placeholder="Strength" required>
                                <label for="floatingStrength">Strength</label>
                            </div>

                            <div class="form-floating mb-3">
                                <input type="number" min="1" max="100"  class="form-control" id="floatingSpeed" name="speed" placeholder="Speed" required>
                                <label for="floatingSpeed">Speed</label>
                            </div>

                            <div class="form-floating mb-3">
                                <input type="number" min="1" max="100" class="form-control" id="floatingDurability" name="durability" placeholder="Durability" required>
                                <label for="floatingDurability">Durability</label>
                            </div>

                            <div class="form-floating mb-3">
                                <input type="number" min="1" max="100" class="form-control" id="floatingPower" name="power" placeholder="Power" required>
                                <label for="floatingPower">Power</label>
                            </div>

                            <div class="form-floating mb-3">
                                <input type="number" min="1" max="100" class="form-control" id="floatingCombat" name="combat" placeholder="Combat" required>
                                <label for="floatingCombat">Combat</label>
                            </div>

                            <div class="d-grid">
                                <button id="salvar" class="btn btn-primary btn-login text-uppercase fw-bold" type="submit">Salvar</button>

                                <button id="save-file" class="btn btn-primary btn-login text-uppercase fw-bold mt-3" type="button">Baixar JSON</button>

                                <a href="http://localhost:5000/" class="btn text-uppercase fw-bold mt-5">desconectar</a>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>

<script>
    let personagens = [];

    function submitForm(event) {
        event.preventDefault();
        var formData = new FormData(event.target);
        const data = {};
        formData.forEach((value, key) => (data[key] = value));
        let hero = {
            id: Number(data.id),
            name: data.name,
            powerstats: {
                intelligence: Number(data.intelligence),
                strength: Number(data.strength),
                speed: Number(data.speed),
                durability: Number(data.durability),
                power: Number(data.power),
                combat: Number(data.combat)
            },
            images : {
                lg: data.image
            }
        };

        personagens.push(hero);
        console.log(personagens);
        resetForm();
        attId();
    };

    // save personagens in json file
    document.getElementById("save-file").addEventListener("click", function() {
        const a = document.createElement("a");
        a.href = URL.createObjectURL(new Blob([JSON.stringify(personagens)], {
            type: "application/json"
        }));
        a.setAttribute("download", "personagens.json");
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
    });

    function attId(){
        document.getElementById("floatingId").value = personagens.length + 1;
    };

    function resetForm(){
        document.getElementById("form-novo-heroi").reset();
    }

    attId();

</script>

</html>